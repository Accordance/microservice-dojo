:toc: left
// :linkcss:
:icons: font
:source-highlighter: coderay
:kata_dir: kata9
ifndef::imagesdir[:imagesdir: images]
:sourcedir: ../../../{kata_dir}

// include::../header.adoc[]

= About Swagger

Swagger is a REST specification that allows you to generate interactive API documentation.

. Swagger generates an interactive API console to quickly learn and try the API.
. Swagger generates the client SDK code needed for implementations on various platforms.
. Swagger allows to generate client code on a lot of different platforms.
. Swagger has a strong community with helpful contributors.

In this exercise you are going to create simple REST web service using Swagger API Documentation.

WARNING: The API documentation generated by the Swagger file is minimal. It shows the resources, parameters, requests, and responses. However, it's not going to provide any other detail about how your API works.

== Step-by-step instructions to bootstrap the project

Follow Kata1 guide to setup a basic service: [Creating Basic Web Service](http://accordance.github.io/microservice-dojo/guides/docs/kata1/creating_basic_web_service.html)

== Swagger Implementation

=== Add dependency jars

Add the following code to the build script:
[source,groovy,indent=0]
.build.gradle
----
include::{sourcedir}/solution/mysvc/build.gradle[tags=swagger]
----

This script will add swagger dependency jars into the application.

=== Bean configuration
The project contains an entry point in the _MysvcApplication.java_ file:

[source,java,indent=0]
.MysvcApplication.java
----
include::{sourcedir}/solution/mysvc/src/main/java/msvcdojo/MysvcApplication.java[tags=code]
----
<1> We have added @EnableSwagger2 annotation to enable this application to use Swagger.

<2> The api() method creates a bean which contains the general information about the API and an inventory of the available resources.

We're going to rename HomeController we created in Kata1 guide to AccountController and add a get API and describe it with swagger annotation.

=== Swagger annotation

[source,java,indent=0]
.AccountController.java
----
include::{sourcedir}/solution/mysvc/src/main/java/msvcdojo/MysvcApplication.java[tags=api]
----

----
include::{sourcedir}/solution/mysvc/src/main/java/msvcdojo/MysvcApplication.java[tags=doc]
----

----
include::{sourcedir}/solution/mysvc/src/main/java/msvcdojo/MysvcApplication.java[tags=model]
----

<1> @Api annotation describes a top-level api. In order to make Swagger aware of your endpoint, you need to annotate your class with @Api annotation.

<2> @ApiOperation annotation provides detailed description of what a certain method does.

<3> @ApiResponses annotation represents a type of response from a server. This can be used to describe both success codes as well as errors. If your Api has different response classes, you can describe them here by associating a response class with a response code.

<4> @ApiImplicitParams annotation represents a single parameter in an API Operation.This allows you to manually define a parameter in a fine-tuned manner.

<5> @ApiParam annotation represents a single parameter in an Api Operation. A parameter is an input to the operation.When working with path or query parameter, you should always provide clarification of what this parameter represents.

<6> @ApiModel annotation models classes to provide the model schema, which helps in understanding/documenting the request response structure using the specific annotation using @ApiModel annotations.

[source,yaml,indent=0]
.application.yml
----
include::{sourcedir}/solution/mysvc/src/main/resources/application.yml[]
----

== Build and launch
Build the service:
----
$ cd mysvc
$ gradlew build
----
Note that this command will build the code and run all the necessary tests.

Lauch it the service:
----
$ java -jar build\libs\mysvc-0.0.1.jar
----

The following output you'll on the screen.

[source,text,options="nowrap"]
----
include::bootRun.txt[]
----
<1> Listening port of the web service
<2> List of available end-points that Actuator provides for you for free.

== Play time

=== Swagger Endpoint Resource Listing
The Resource Listing serves as the root document for the API description. It contains general information about the API and an inventory of the available resources.

By default, this document SHOULD be served at the /api-docs path.
----
$ curl http://localhost:8100/v2/api-docs
----

The output of this CURL command will look like this:

[source,json,indent=0]
----
{
    "swagger": "2.0",
    "info": {
    "description": "Spring REST Sample with Swagger",
    "version": "2.0",
    "title": "Spring REST Sample with Swagger",
	...
	},
"host": "localhost:8100",
"basePath": "/",
"tags": [{
    "name": "mysvc",
    "description": "Endpoint for account management"
}
"paths": {
    "/mysvc/delete/{id}": {
		"delete": {
			"tags": ["mysvc"],
			"summary": "delete Account By Id",
			"description": "Deletes an account by passing accountId",
			"operationId": "deleteUsingDELETE",
			"consumes": ["application/json"],
			"produces": ["*/*"],
			...
			}
		}
	}
}
----

=== Running it with Swagger UI

Swagger UI takes Swagger specification files, presents them visually and allows you to execute operations.


----
$ curl http://localhost:8100/swagger-ui.html
----

The output of this CURL command will look like this:

[.thumb]
image::swagger-ui.jpg[scaledwidth=75%]

=== Shutdown

Actuator is not enabling a couple of "dangerous" end-points. One of them is the
one that the automation infrastructure may use to shutdown the service.

You can send an empty POST request to this endpoint for the service gracefully
shutdown itself.

----
$ curl -d {} http://localhost:8080/shutdown
----

== Bonus
You can read more about all this in http://swagger.io/.
